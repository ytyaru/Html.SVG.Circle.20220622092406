# モナコイン取引ユーザのアイコンを円形状に並べる

## イメージ図

```
　　●
　●●●
●●自●●
　●●●
　  ●
```

## 取引によって生まれるつながり、社会

　取引は支払と受取の２つに大別される。それらをユーザ中心の図にし、その相関図を社会とみなすなら、その図は以下のような２種類の意図になる。

* 自分が支援した人々を俯瞰する図
* 自分を支援してくれた人々を俯瞰する図

　自分は自分にとって価値あること、いいね！と思ったことをしている人たちにモナコインを支払う。だから自分がモナコインを支払った人たちは、自分にとって価値ある人たちだともいえる。自分が関わることでなした関係や社会は、そのまま自分の価値観を示す。自分はどんなことに価値を見出すのか。その結果、だれが、何をし、どうなるのか。そうしたことを、それをしている人を起点として俯瞰できるようになる。そのユーザのプロフィールから、URLから、詳しくみることができる図となる。

　自分のやっていることにモナコインを支払ってくれる人がいる。それをいいね！と思ってくれ、価値を見出してくれた人たちによって、自分は社会的に価値を認められ、存在することを許されたように錯覚できる。それは所属欲であり承認欲求であり生存欲である。もし、自分の好きなことをやり、それが認められ、対価をいただけるなら、自分は自分のまま無理せず偽ることなく生きてゆける。もう特定の価値観を強いる学校や会社、国といったものに支配されず、イジメやパワハラや搾取に泣き寝入りせずに済む。自分の価値観を先鋭化することで、自分の価値を高め、自分の人生を生きていける。そう信じられる根拠になる。それを可視化し証明するグラフにしたい。

### お金は無価値

　お金は無価値。いくら手に入れようが、それ自体は無価値。

### 価値の正体は生産者

　価値があるのは生産物であり生産活動であり生産者である。

### 価値あることは生産すること

　お金は人を生産活動に導く動機づけとして利用する道具であるべき。断じて、お金がなければ生きていけないような本末転倒の状態にすべきでない。

　生産活動は無理強いされるべきではない。あくまで、自分がやりたいことを、やりたいときに、やりたいぶんだけ、やりたいようにやればいい。人は利己によって動くものだから、そうすることしかできない。それに従うことが合理的である。また、自分の気持ちと意思と覚悟が同じひとつの方向をむいたとき、人は最大の力を発揮できる。だから好きなことを好きなようにやるのが最大効率であり現実的に実現可能な方法である。

　お金は、人をよりよく、幸福になるよう導く道具であるべき。だから、好きなことをし、それに価値を見出しあい、応援するためのツールとして、お金を使うべき。私はそのために、暗号通貨モナコインの取引ユーザ相関図を作りたい。

### 価値とは幻想である

　価値とは人が見出す夢であり幻だ。決して物理的に存在するものではない。モノは存在するが、そこに夢や希望、理想、期待を見出しているのは人間であり、それが価値である。ならば価値とは人の頭の中にしかない幻想だ。

　お金に価値を見る。モノに価値を見る。人に価値を見る。それらはすべて自分の都合で作り出した幻である。けれど人は、その幻を糧にして、見えない明日、まだ存在しない素晴らしいものを作り出そうとする。人は夢を活力として生きている。

　もし、何も信じられず、人を信じられず、明日を信じられなくなれば、その社会、構成員である人間たち、彼らがする仕事、それらを取引する通貨、すべてに価値がなくなる。世の中が悪事に満ちており、明日につながるどころか、未来を食いつぶすだけだとわかってしまったら、もはやそれに価値を、夢をみることはできない。

　私は生きるために、信じられる夢をつくるために、新しい社会、関係、つながり方、働き方、生き方を模索すべきだと思う。けれど形のないもの、見えないものは、存在しないのと同じ。夢に存在力をもたせ、信じられるようにするためには、見える化する必要がある。だから取引ユーザ相関図を作りたい。

## 支援すること・されること

　自分の価値観に従っていれば、誰かを支援することも、誰かに支援してもらうことも、生きるための力になる。自分にとって価値あることをしている人を支援すれば、彼らが活動するほど、自分にとって価値あるものであふれる世界になる。それは自分にとって喜ばしいことである。もし自分の支払いがその実現につながるなら、それは自分にとって価値あることだ。

　もし、自分の活動に価値を見出してくれる人がいて、その人に支援してもらえば、自分はそれを糧に、さらに活動できる。自分の好きなこと、自分にとって価値あることに力を尽くし活動すればするほど、した分だけ、自分にとって価値ある時間をすごせるし、その活動の結果、自分にとって価値ある成果物が生まれる。それをやったのが自分自身であれば、自信と誇りをもてるようになり、そう思えることが喜びになる。それを他の人にも認めてもらえている事実が、さらに喜びとなる。その気持ちが、また次の生産活動に向かう動機となる。

　かくして通貨は、人を生産活動へと駆り立てる道具として、人をよりよい豊かで幸福な人生に導く道具として、人々の間を流通するのである。これが正しいお金であり、私が思う理想のお金の姿だ。私はモナコインを、こうしたものとして使いたい。そのためのきっかけづくりのひとつとして、取引ユーザ相関図を作りたい。

# グラフ

## 自分が支払ったユーザ俯瞰図

* 自分が一番中心で一番大きい
* 自分に支払われた額が大きいほど

https://teratail.com/questions/376112?rss=all

## 自分に支払ってくれたユーザ俯瞰図

* 自分が一番中心で一番大きい
* 自分に支払われた額が大きいほど自分に近い
* 自分に近いほど大きく、遠いほど小さい

　HTMLで表示するためにはCanvasかSVGにする必要がある。HTML要素で円形に表示するのは難しそうな気がする。

* [円周上に要素を配置したい、配置はできたが傾いているのでバランスを整えたい](https://teratail.com/questions/376112?rss=all)

　とりあえず以下のようなサイズで作ると仮定してみる。すると240pxサイズになる。ひとまずこれで作ってみる。

* 自分96px
* 外１64px
* 外２48px
* 外３32px

　はたして、これで何人表示できるだろうか。数学を使えば計算できるのかもしれない。

　たとえば96pxサイズの円の外周に64pxの円は最大でいくつ並べることができるのか。

　角度を基準に考えてみる。90度単位だと360度なので4個置ける。時計のように12個配置するなら、360度/12個＝30度。では、30度ずつ並べるとして、隣どおしが重なり合わないといえるか？　重なり合わずにすむ最大配置数はいくつ？　何度おきに配置すればいい？　それをどうやって計算すればいい？　私は算数が大の苦手なので、まったくわからない。

　たぶん、`96px + (64/2) = 128`が外１に並ぶ円たちの中央線になる。そこから何度傾ければ、ぶつからずに済むのか。それをどう計算したらいいのか。円の中点同士の直線距離から算出できるはず。たぶん円同士の中点の直線距離が、円のサイズと同じ64pxなら、ギリギリ重ならない最小距離だろう。円周上に並べた上で、円の中点の直線距離が直径とおなじであれば、重ならない。

　でも、角度が算出できない。直径`96px + (64/2) = 128`pxの円の外周。それが外１の中点同士を結ぶ外周になる。そこに中点をあわせて64pxの円を配置するとして、何度ずつ配置すればいい？　わからん。

　とりあえず時計のように１２個配置してみよう。でも、１２人より少なかったら？　360度を人数で割る。とりあえず最大配置数を１２と仮定し、それより小さければその数で割る。それより大きければ１２で割る。そういうことにしておこう。ここ、うまいこと計算式に落とし込みたいのだが。数学力が足りない。

　とりあえず円周上に並べる式をググったら以下のようなのが見つかった。

```javascript
var x = Math.cos(red * i - Math.PI/2) * circle_r + circle_r;
var y = Math.sin(red * i - Math.PI/2) * circle_r + circle_r;
```

> 「Math.PI/2」は 90 度回転させることを意味しています。

　サイン・コサイン・タンジェント。中学で習ったが、まったくこれっぽっちも理解できなかった記憶がある。方程式という言葉だけで鳥肌が立つほどの数学アレルギー。そんな私に、この問題が解けるだろうか。数学は答えが明確なので気持ちいいし、そこは好きなのだが、私の脳みそが数学についていけない。

　わからんなりに解読してみよう。

　`Math.PI`は円周率`3.14`。`r`は半径のことだろう。`red`,`i`がわからん。`cos`,`sin`はコサイン、サインで、たぶん角度を算出するのだろう。それを係数として半径と掛け合わせることで座標に変換している式とみた。

　`red`,`i`に関しては質問元のコードにあると思う。

```javascript
$(function(){
var item_num = $('div.item').length;
var deg = 360.0/item_num;
var red = (deg*Math.PI/180.0);
var circle_r = $("div.item").width() * 1.3;
$('div.item').each(function(i, elem) {
var x = Math.cos(red * i) * circle_r + circle_r;
var y = Math.sin(red * i) * circle_r + circle_r;
$(elem).css('left', x);
$(elem).css('top', y);
});
});
```

　`red = (deg*Math.PI/180.0)`とある。`deg`は角度だと思う。`deg = 360.0/item_num`とある。360度を、並べるアイテムの数で割っている。たぶん、時計でいうところの12個配置したら30度になるという部分だろう。`red`はその`deg`に`円周率/180`を掛けている。一体それは何の値なのか。

　とりあえず`deg`は角度で、たぶん角度は0〜360のはず。それを`3.14/180`した値と掛ける？　なんかどこかで見たことあるような気がするが、覚えてない。算数怖い。とりあえず、`deg`を`0`とすると、`0*3.14/180`になる。`0/180`。それってつまり、ゼロってことでいいのか？　ダメだ、算数すらわからない。アホー知恵袋に答えがある：https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1131647086　はいゼロですね。`red = 0`。その`red`を使って座標x,yを求めている。`x = Math.cos(red * i) * circle_r + circle_r`。その答えは`circle_r`。そして`circle_r = $("div.item").width() * 1.3`。なんで`1.3`倍してんの？　このマジックナンバーはどこからきたの？　`r`って半径のことではないの？　半径は`width / 2`じゃないの？　`circle_r`がなんなのか謎。とりあえず32pxと仮定しておこう。つまりdeg=`0`度のときのx,y座標は`32px`ということになる。

　よくわからんね。

　あと、これをどうやってSVGに落とし込むか。以下のようになると思う。

```html
<svg width="240" height="240">
  <a href="ユーザサイトURL"><image href="アバター画像URL" width="96" height="96" x="計算値" y="計算値" /></a>
  <a href="ユーザサイトURL"><image href="アバター画像URL" width="64" height="64" x="計算値" y="計算値" /></a>
  <a href="ユーザサイトURL"><image href="アバター画像URL" width="64" height="64" x="計算値" y="計算値" /></a>
  <a href="ユーザサイトURL"><image href="アバター画像URL" width="64" height="64" x="計算値" y="計算値" /></a>
  ...
</svg>
```

* https://developer.mozilla.org/ja/docs/Web/SVG/Element/image

　本当はこれにユーザ名や投げモナボタンもつけたい。けれど今は妥協しておく。そもそも、作った投げモナボタンはHTMLでJSなので、SVGで動作させられるかわからない。

　もしHTMLでやるなら座標指定は面倒になりそう。

```html
<a href="ユーザサイトURL"><img src="アバター画像URL" width="64" height="64" style="position:absolute; left:200px; top:50px;" /></a>
```

　本来これはCSSでセットすべきかもしれない。HTMLはあくまで文書の構造を定義するものだから。でも、画像がいくつできるかは動的であり事前に決められない。その値がいくつになるかも然り。なら、CSSクラス名を使っての指定をすることも難しい。上記のようなHTMLを、JSによって動的に生成するのが現実的だろう。

　とりあえずSVGのほうがスマートに座標指定できるし、グラフィクスに関してはSVG文脈でするのが正しい構造化だと思われる。だからSVGを使うことにしよう。投げモナボタン問題については、今は保留。

## 試作

　まずは固定位置でSVGを書いてみて確認してみる。

　自分のアイコンの画像を表示する左上の座標は次のように求められる。画像全体が240pxだとしたときの試算。

```
72 = (240 / 2) - (96 / 2)
```

　その外周に４つの他の人のアイコンを並べたい。そのサイズは64pxである。自分の画像の真上をスタート地点として時計回りに配置したい。このとき、それぞれのX,Y座標はいくつか。

```
90:  72,          72-(64/2)
180: 72+96+(64/2) 72
270: 72           72+(64/2)
0:   72-(64/2)    72
```
```
90:   72,  40
180: 200,  72
270:  72, 104
0:    40,  72
```

　全然違った。表示してみるとぐちゃぐちゃだった。直径が96と64で違うため、中点の算出も変わる。そのせいかな。

```
88 = (240 / 2) - (64 / 2)
```
```
90:  88,                  72-(96/2)=24
180: 72+(96/2)+(64/2)=152 88
270: 88                   72+(64/2)
0:   72-(64/2)            88
```

　高さがおかしい。72はあくまで中央画像における左上の座標値。中点ではない。

```
90:  88,       72-64=8
180: 72+96=168 88
270: 88        72+96=168
0:   72-64=8   88
```

　これでやっと、各画像を、中点を中心に上下左右に配置できた。重なることなく。

　次は、すべての画像を円形に切り抜きたい。

* https://b-risk.jp/blog/2018/07/svg-clippath/



