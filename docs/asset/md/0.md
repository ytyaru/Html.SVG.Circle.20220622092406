# やりたいこと

　自分と取引のあるアドレスを、自分のアイコン中心に円周状に並べたい。これをもってモナコイン取引ユーザ相関図とする。

## 方法

* 取引アドレスはトランザクション取得APIによって入手する
* アイコン画像は[mpurseのアドレスとプロフィールを登録する][]によって登録されたデータから取得する

[mpurseのアドレスとプロフィールを登録する]:https://ytyaru.github.io/Html.GAS.Mastodon.Misskey.Address.Profile.20220620171245/

# 問題

　どうやって画像を円周状に並べるか。

方法|問題
----|----
HTMLの`<img>`タグ|座標指定できない。CSSを併用する必要があり冗長になる
Canvas|Canvas APIを勉強せねばならない
SVGの`<image>`タグ|`x`,`y`属性値の値をどうやって算出するか

　SVGテキストを作ることで実現する。これならそのSVGテキストをコピーするだけでどこでも再現可能になる。ただ、円周状に並べるための座標計算がわからない。

　私は算数や数学が大の苦手である。

1. 画像の全体サイズを算出する
2. 取引の中心となるアドレスを画面中央に表示する
3. 2の円周状に真上を始点として時計回りに取引ユーザのアイコンを取引額が多い順に並べる
4. 3の円周状に同様に並べる。ただしアイコンを少し小さくする。以後、これを繰り返す

## 1. 画像の全体サイズを算出する

1. 中央画像サイズ
2. 外周ユーザ数とそれらのサイズ
3. 画像の全体サイズ

項目|数|考え
----|--|----
中央画像サイズ|96p|大きすぎず小さすぎず。スマホでも全体像が表示できそうでPCでも小さすぎず。
外周ユーザ数|256|2^8。このくらい表示できれば、それなりの規模である。ひとまずこれを最大値とする。
外周ユーザ画像サイズ|72,64,48,32,24,20。中央画像より小さい。外側ほど小さくなる。かつ最小サイズ16px以上。256人分表示できる。
画像の全体サイズ|`376=96+((72+64+48+32+24+20)*2)`|重ならずぴったりくっついた必要最小サイズ

　外周における配置数とサイズ。

配置数|サイズ
------|------
8|72
16|64
32|48
48|32
64|24
88|20

　`256人=8+16+32+48+64+88`。

　はたしてこれで、本当にこのサイズでこの配置数を実現できるのか。わからない。その算出方法があるのか。わからない。

## 2. 取引の中心となるアドレスを画面中央に表示する

1. 画面中央の座標を算出する
2. 画像を表示する始点である左上座標を算出する

```javascript
const cw = 画像全体の幅 / 2
const ch = 画像全体の高さ / 2
```
```javascript
const left = (画像全体の幅 / 2) - (アイコンの幅 / 2)
const top = (画像全体の高さ / 2) - (アイコンの高さ / 2)
```
```html
<svg>
  <image x="${left}" y="${top}" />
</svg>
```

　画像全体サイズ240px、アイコン画像96pxとしたとき、アイコンを中央に表示する座標はいくつか？

```javascript
const cw = 240 / 2
const ch = 240 / 2
const left = cw - (96 / 2)
const top = ch - (96 / 2)
```
```
left = 120 - 48 = 72
```
```html
<svg>
  <image x="72" y="72" />
</svg>
```

### 2-1. アイコンを円形にクリッピングする

```xml
<svg width="240" height="240">
  <rect x="0" y="0" width="240" height="240" style="fill:green" />
  <defs>
    <style type="text/css"><![CDATA[
      .clip-96 { clip-path: circle(48px at center); }
    ]]></style>
  </defs>
  <a href="https://ytyaru.github.io/"><image href="./asset/image/avator.png" width="96" height="96" x="72" y="72" class="clip-96"/></a>
</svg>
```

　ポイントは以下CSSである。`clip-path`で画像を指定したパスにもとづき切り抜く。そのパスは`circle()`関数で指定する。引数は半径と座標。96pxの矩形画像を、半径48pxの正円で切り抜く。

```css
.clip-96 { clip-path: circle(48px at center); }
```
　


## 3. 2の円周状に真上を始点として時計回りに取引ユーザのアイコンを取引額が多い順に並べる
## 4. 3の円周状に同様に並べる。ただしアイコンを少し小さくする。以後、これを繰り返す


# 取引の中心となるアドレスを画面中央に表示する

# 取引の中心となるアドレスを画面中央に表示する



